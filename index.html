<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>TheraSpace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Chargement fiable des ic√¥nes Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    body { background-color: #0f0b1e; color: white; -webkit-tap-highlight-color: transparent; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    /* Animations */
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } } .animate-fade-in { animation: fade-in 0.5s ease-out; }
    @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } } .animate-slide-up { animation: slide-up 0.4s ease-out; }
    @keyframes pulse-slow { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } } .animate-pulse-slow { animation: pulse-slow 3s infinite; }
    @keyframes flip-in { from { transform: rotateY(90deg); opacity: 0; } to { transform: rotateY(0); opacity: 1; } } .animate-flip-in { animation: flip-in 0.6s ease-out; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- SYSTEME D'ICONES ROBUSTE (Anti-Crash) ---
    // Ce composant va chercher l'ic√¥ne dans la librairie globale lucide
    const Icon = ({ name, size = 24, className = "" }) => {
      const lucideIcon = window.lucide && window.lucide.icons ? window.lucide.icons[name] : null;
      if (!lucideIcon) return null;
      
      // On convertit les donn√©es de l'ic√¥ne en SVG React
      return (
        <svg 
          xmlns="http://www.w3.org/2000/svg" 
          width={size} 
          height={size} 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          strokeWidth="2" 
          strokeLinecap="round" 
          strokeLinejoin="round" 
          className={className}
          dangerouslySetInnerHTML={{ __html: lucideIcon.map(child => `<${child[0]} ${Object.entries(child[1]).map(([k, v]) => `${k}="${v}"`).join(' ')} />`).join('') }}
        />
      );
    };

    // --- CONFIG API ---
    // Pour que l'IA fonctionne, vous devez configurer le fichier api/chat.js comme expliqu√© pr√©c√©demment.
    // Sinon, l'app utilisera le mode simulation int√©gr√©.
    
    // --- MOTEUR LYA (IA) ---
    const LYA_AI = {
      analyzeHero: async (scores) => {
        // Simulation intelligente si pas d'API
        await new Promise(r => setTimeout(r, 1500));
        let archetype = "Guerrier";
        if (scores.knowledge > scores.competence) archetype = "Sage";
        else if (scores.belonging > scores.security) archetype = "Gardien";
        
        return {
            title: `${archetype} de Lumi√®re`,
            stats: scores,
            mission: `Ton score de comp√©tence est de ${Math.round((scores.competence/15)*100)}%. D√©fi : Fais une chose que tu repousses depuis 2 jours.`
        };
      },
      generateOracle: async () => {
         const SAGES = ["Le Vieux Sage", "L'Esprit de la For√™t", "Le Ph√©nix"];
         const QUOTES = ["La rivi√®re ne force pas son passage.", "M√™me l'arbre le plus grand a commenc√© graine.", "Apr√®s la pluie vient le soleil."];
         return { title: SAGES[Math.floor(Math.random()*SAGES.length)], text: QUOTES[Math.floor(Math.random()*QUOTES.length)] };
      },
      synthesizeIdentity: async (answers) => "Tu as une personnalit√© riche et unique (Synth√®se auto).",
      analyzeEcho: async (history) => ({ observation: "Tu g√®res bien tes √©motions.", conseil: "Continue d'utiliser la gratitude." })
    };

    // --- DATA ---
    const SCENARIOS = [
      { id: 1, text: "Tu ouvres Insta et tu tombes sur une story : tous tes potes sont ensemble sans toi.", type: 'neg' },
      { id: 2, text: "Le prof rend les contr√¥les. Tu caches ta feuille car tu as honte de ta note.", type: 'neg' },
      { id: 3, text: "Tes parents te reprochent encore d'√™tre 'tout le temps sur ton t√©l√©phone'.", type: 'neg' },
      { id: 20, text: "Tu as r√©ussi un truc difficile du premier coup. Fiert√© !", type: 'pos' },
      { id: 30, text: "Tu es seul(e) chez toi. Le silence est total.", type: 'neu' }
    ];
    const EMOTIONS = [
      { id: 'colere', emoji: 'üò°', label: 'Rage' }, { id: 'peur', emoji: 'üò∞', label: 'Stress' },
      { id: 'tristesse', emoji: 'üò¢', label: 'Tristesse' }, { id: 'honte', emoji: 'üò≥', label: 'Honte' },
      { id: 'vide', emoji: 'üò∂', label: 'Vide' }, { id: 'calme', emoji: 'üòå', label: 'Calme' },
      { id: 'joie', emoji: 'ü§©', label: 'Joie' }, { id: 'confiance', emoji: 'ü¶Å', label: 'Fiert√©' },
    ];
    const STRATEGIES = [
      { id: 'parler', icon: "MessageCircle", label: "J'en parle" }, { id: 'musique', icon: "Play", label: "Musique" },
      { id: 'isolement', icon: "Moon", label: "Je m'isole" }, { id: 'sport', icon: "Activity", label: "Je bouge" },
      { id: 'scroll', icon: "Fingerprint", label: "√âcrans" }, { id: 'art', icon: "Sparkles", label: "Cr√©ation" },
      { id: 'gratitude', icon: "Heart", label: "Gratitude" }, { id: 'savourer', icon: "Sun", label: "Je savoure" },
    ];
    const HERO_QUIZ = [
      { cat: 'competence', q: "Je finis ce que je commence." }, { cat: 'competence', q: "Je sais r√©soudre mes probl√®mes." }, 
      { cat: 'competence', q: "J'ai des talents dont je suis fier(e)." }, { cat: 'knowledge', q: "Je connais mes forces." },
      { cat: 'security', q: "Je me sens bien dans ma peau." }, { cat: 'belonging', q: "Je me sens aim√©(e)." }
    ];
    const IDENTITY_QS = [
      { id: 'surnom', label: "Mon Surnom" }, { id: 'force', label: "Ma Force" }, { id: 'hobby', label: "Passion" }, 
      { id: 'song', label: "Chanson Hype" }, { id: 'dream', label: "R√™ve fou" }
    ];

    // --- UI HELPERS ---
    const GlassPanel = ({ children, className = '', onClick }) => (
      <div onClick={onClick} className={`backdrop-blur-xl bg-[#1e1b4b]/70 border border-white/10 shadow-2xl rounded-[32px] overflow-hidden ${className}`}>
        {children}
      </div>
    );
    const ActionButton = ({ onClick, children, variant = 'primary', className = '', disabled }) => {
      const s = { 
        primary: "bg-gradient-to-r from-violet-600 to-indigo-600 shadow-indigo-500/30 text-white", 
        secondary: "bg-white/5 text-white border border-white/10", 
        accent: "bg-gradient-to-r from-emerald-500 to-teal-500 text-white", 
        gold: "bg-gradient-to-r from-amber-400 to-orange-500 text-white" 
      };
      return <button onClick={onClick} disabled={disabled} className={`px-6 py-4 rounded-2xl font-bold transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-2 ${s[variant]} ${className}`}>{children}</button>;
    };

    // --- MODULES ---
    
    // SOS
    const SOSModal = ({ onClose }) => (
        <div className="absolute inset-0 z-[100] bg-slate-900/95 backdrop-blur-xl flex items-center justify-center p-6 animate-fade-in">
            <div className="w-full max-w-sm bg-[#1e1b4b] border border-red-500/30 rounded-[32px] p-6 text-center shadow-[0_0_50px_rgba(220,38,38,0.3)]">
                <div className="w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6 text-red-500 animate-pulse"><Icon name="AlertTriangle" size={40}/></div>
                <h2 className="text-3xl font-black text-white mb-2">Besoin d'aide ?</h2>
                <div className="space-y-4">
                    <a href="tel:3114" className="block w-full bg-red-600 text-white font-bold py-5 rounded-2xl shadow-lg flex items-center justify-center gap-3"><Icon name="Phone" size={24}/> 31 14 (√âcoute)</a>
                    <a href="tel:15" className="block w-full bg-white text-slate-900 font-bold py-5 rounded-2xl shadow-lg flex items-center justify-center gap-3"><Icon name="Activity" size={24}/> 15 (Urgence)</a>
                </div>
                <button onClick={onClose} className="mt-8 text-slate-500 font-bold text-sm uppercase tracking-widest">Retour</button>
            </div>
        </div>
    );

    // Auth
    const AuthScreen = ({ onLogin }) => {
        const [email, setEmail] = useState(''); const [pin, setPin] = useState('');
        return (
            <div className="h-full flex flex-col items-center justify-center p-8 animate-fade-in">
                <div className="w-24 h-24 rounded-full bg-gradient-to-tr from-violet-600 to-indigo-600 flex items-center justify-center shadow-[0_0_50px_rgba(139,92,246,0.5)] mb-8 border-4 border-[#0f0b1e]"><Icon name="Fingerprint" size={40} className="text-white"/></div>
                <h1 className="text-3xl font-black text-white mb-2">TheraSpace</h1>
                <p className="text-slate-400 mb-10">Ton refuge num√©rique.</p>
                <div className="w-full space-y-4">
                    <GlassPanel className="p-4 flex items-center gap-3"><Icon name="Mail" className="text-slate-500" size={20}/><input type="email" placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} className="bg-transparent text-white w-full focus:outline-none"/></GlassPanel>
                    <GlassPanel className="p-4 flex items-center gap-3"><Icon name="Lock" className="text-slate-500" size={20}/><input type="password" placeholder="Code (ex: 0000)" value={pin} onChange={e=>setPin(e.target.value)} className="bg-transparent text-white w-full focus:outline-none font-bold tracking-widest"/></GlassPanel>
                    <ActionButton onClick={() => onLogin({ name: email.split('@')[0] || 'Voyageur' })} disabled={!email || pin.length < 4} className="w-full mt-4">Entrer <Icon name="ArrowRight"/></ActionButton>
                </div>
            </div>
        );
    };

    // Dashboard
    const Dashboard = ({ onNavigate, user }) => {
        const [showSOS, setShowSOS] = useState(false);
        return (
            <div className="h-full overflow-y-auto scrollbar-hide p-6 pt-10 pb-32 space-y-8 animate-fade-in relative">
                {showSOS && <SOSModal onClose={() => setShowSOS(false)} />}
                <header className="flex justify-between items-center">
                    <div><h1 className="text-3xl font-black text-white tracking-tight mb-1">Salut {user.name}</h1><p className="text-indigo-300 text-sm">Espace S√©curis√©</p></div>
                    <div className="flex gap-3">
                        <button onClick={()=>setShowSOS(true)} className="w-12 h-12 rounded-full bg-red-500/10 border border-red-500/20 flex items-center justify-center text-red-500 animate-pulse"><Icon name="AlertTriangle" size={24}/></button>
                        <button onClick={()=>onNavigate('profile')} className="w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-slate-400"><Icon name="User" size={24}/></button>
                    </div>
                </header>
                <div onClick={()=>onNavigate('echo')} className="relative group cursor-pointer active:scale-95 transition-transform">
                    <div className="absolute inset-0 bg-gradient-to-r from-violet-600 to-indigo-600 rounded-[32px] blur opacity-60"/>
                    <GlassPanel className="relative p-8 flex items-center justify-between">
                        <div><div className="flex items-center gap-2 mb-2"><span className="w-2 h-2 rounded-full bg-green-400 animate-pulse"/><span className="text-xs font-bold text-indigo-200 uppercase tracking-wider">Lya Active</span></div><h3 className="text-3xl font-black text-white mb-2">√âCHO</h3><p className="text-slate-300 text-sm">Exploration guid√©e</p></div>
                        <div className="w-16 h-16 rounded-full bg-white/10 flex items-center justify-center text-white"><Icon name="Play" size={24}/></div>
                    </GlassPanel>
                </div>
                <div className="grid grid-cols-2 gap-4">
                    <GlassPanel className="p-6 active:scale-95 transition-transform" onClick={()=>onNavigate('journal')}><Icon name="Book" className="text-emerald-400 mb-4" size={28}/><h4 className="font-bold text-white">Journal</h4></GlassPanel>
                    <GlassPanel className="p-6 active:scale-95 transition-transform" onClick={()=>onNavigate('hero')}><Icon name="Shield" className="text-amber-400 mb-4" size={28}/><h4 className="font-bold text-white">H√©ros</h4></GlassPanel>
                </div>
            </div>
        );
    };

    // Hero Module
    const HeroModule = ({ onExit }) => {
        const [step, setStep] = useState('intro'); const [currentQ, setCurrentQ] = useState(0); const [scores, setScores] = useState({competence:0, knowledge:0, security:0, belonging:0}); const [aiResult, setAiResult] = useState(null);
        const handleAnswer = (val) => {
            const cat = HERO_QUIZ[currentQ].cat;
            setScores({...scores, [cat]: scores[cat] + val});
            if(currentQ < HERO_QUIZ.length-1) setCurrentQ(c=>c+1);
            else { setStep('loading'); LYA_AI.analyzeHero(scores).then(res => { setAiResult(res); setStep('result'); }); }
        };
        if(step==='intro') return <div className="h-full p-8 flex flex-col items-center justify-center text-center animate-fade-in"><Icon name="Crown" size={64} className="text-amber-400 mb-6"/><h2 className="text-3xl font-black mb-4">Forge des H√©ros</h2><p className="text-slate-400 mb-8">D√©couvre tes forces cach√©es.</p><ActionButton onClick={()=>setStep('quiz')} variant="gold">Commencer</ActionButton><button onClick={onExit} className="mt-8 text-slate-500">Quitter</button></div>;
        if(step==='quiz') return <div className="h-full p-8 flex flex-col justify-center animate-slide-up"><div className="mb-4 text-xs font-bold text-amber-400 uppercase">Question {currentQ+1}/{HERO_QUIZ.length}</div><h3 className="text-xl font-bold mb-8 text-center">"{HERO_QUIZ[currentQ].q}"</h3><div className="grid gap-3"><ActionButton onClick={()=>handleAnswer(3)} variant="secondary">Tout √† fait</ActionButton><ActionButton onClick={()=>handleAnswer(2)} variant="secondary">Plut√¥t oui</ActionButton><ActionButton onClick={()=>handleAnswer(1)} variant="secondary">Plut√¥t non</ActionButton><ActionButton onClick={()=>handleAnswer(0)} variant="secondary">Pas du tout</ActionButton></div></div>;
        if(step==='loading') return <div className="h-full flex items-center justify-center"><Icon name="Sparkles" className="animate-spin text-amber-400" size={48}/></div>;
        return (
            <div className="h-full p-6 pt-10 flex flex-col items-center animate-fade-in">
                <h2 className="text-2xl font-black text-white mb-6">Ton Avatar</h2>
                <div className="w-full max-w-sm bg-gradient-to-br from-amber-500 to-orange-700 p-1 rounded-3xl shadow-2xl animate-slide-up">
                    <div className="bg-slate-900 rounded-[20px] p-6 flex flex-col items-center text-center">
                        <Icon name="Crown" className="text-amber-400 mb-4" size={40}/>
                        <h3 className="text-2xl font-black italic text-white mb-6">{aiResult.title}</h3>
                        <div className="w-full space-y-4">
                            <div className="flex justify-between text-xs font-bold text-slate-400 uppercase"><span>Comp√©tence</span><span>{Math.round(aiResult.stats.competence/15*100)}%</span></div>
                            <div className="h-2 bg-slate-800 rounded-full"><div className="h-full bg-emerald-500" style={{width:`${aiResult.stats.competence/15*100}%`}}/></div>
                        </div>
                        <div className="mt-6 pt-4 border-t border-white/10 w-full text-left">
                            <p className="text-[10px] text-amber-400 font-bold uppercase tracking-widest">Mission Lya</p>
                            <p className="text-white text-xs mt-1">{aiResult.mission}</p>
                        </div>
                    </div>
                </div>
                <button onClick={onExit} className="mt-8 text-white font-bold">Retour</button>
            </div>
        );
    };

    const EchoGame = ({ onExit, onFinish }) => {
        const [cards, setCards] = useState(SCENARIOS.slice(0,10));
        const [index, setIndex] = useState(0);
        const [step, setStep] = useState('scenario');
        const [history, setHistory] = useState([]);
        const [current, setCurrent] = useState({vecu:false, emotions:[], strategies:[]});
        const card = cards[index];
        const handleNext = () => { const newHistory = [...history, {card, ...current}]; if (index < cards.length - 1) { setHistory(newHistory); setIndex(i=>i+1); setStep('scenario'); setCurrent({vecu:false, emotions:[], strategies:[]}); } else onFinish(newHistory); };
        const toggle = (list, item) => list.includes(item) ? list.filter(i=>i!==item) : [...list, item];
        return (
            <div className="h-full flex flex-col p-6 pt-10 relative">
                <div className="flex justify-between items-center mb-6"><button onClick={onExit}><Icon name="X" className="text-slate-400"/></button><span className="text-indigo-400 font-bold text-xs uppercase">Carte {index+1}/{cards.length}</span><div className="w-6"/></div>
                <div className="w-full h-1 bg-slate-800 rounded-full mb-6"><div className="h-full bg-fuchsia-500 transition-all" style={{width: `${((index+1)/cards.length)*100}%`}}/></div>
                <GlassPanel className="flex-1 flex flex-col relative overflow-hidden">
                    {step==='scenario' ? (
                        <div className="flex-1 flex flex-col justify-center items-center p-8 text-center animate-slide-up">
                            <h2 className="text-2xl font-black text-white leading-snug mb-12">"{card.text}"</h2>
                            <div className="grid grid-cols-2 gap-4 w-full mt-auto"><ActionButton variant="secondary" onClick={()=>{setCurrent({...current, vecu:false}); handleNext()}}>Pas v√©cu</ActionButton><ActionButton variant="primary" onClick={()=>{setCurrent({...current, vecu:true}); setStep('interaction')}}>C'est v√©cu</ActionButton></div>
                        </div>
                    ) : (
                        <div className="flex-1 flex flex-col p-6 overflow-y-auto animate-slide-up">
                            <button onClick={()=>setStep('scenario')} className="text-slate-400 mb-4 flex gap-2 items-center"><Icon name="ArrowLeft" size={16}/> Retour</button>
                            <div className="space-y-6">
                                <div><p className="text-slate-500 text-xs font-bold uppercase mb-2">√âmotions</p><div className="flex flex-wrap gap-2">{EMOTIONS.map(e=><button key={e.id} onClick={()=>setCurrent({...current, emotions:toggle(current.emotions, e.id)})} className={`px-3 py-2 rounded-xl border text-sm font-bold flex gap-2 ${current.emotions.includes(e.id)?'bg-fuchsia-500 border-fuchsia-400':'bg-white/5 border-white/10 text-slate-400'}`}>{e.emoji} {e.label}</button>)}</div></div>
                                <div><p className="text-slate-500 text-xs font-bold uppercase mb-2">R√©action</p><div className="grid grid-cols-2 gap-2">{STRATEGIES.map(s=><button key={s.id} onClick={()=>setCurrent({...current, strategies:toggle(current.strategies, s.id)})} className={`p-3 rounded-xl border text-sm font-bold flex flex-col items-center gap-2 ${current.strategies.includes(s.id)?'bg-indigo-600 border-indigo-500':'bg-white/5 border-white/10 text-slate-400'}`}><Icon name={s.icon} size={18}/> {s.label}</button>)}</div></div>
                            </div>
                            <ActionButton onClick={handleNext} disabled={current.emotions.length===0} className="mt-8 w-full">Suivant</ActionButton>
                        </div>
                    )}
                </GlassPanel>
            </div>
        );
    };

    const OracleModule = ({ onExit }) => {
        const [result, setResult] = useState(null); const [loading, setLoading] = useState(false);
        const drawOracle = () => { setLoading(true); LYA_AI.generateOracle().then(res => { setResult(res); setLoading(false); }); };
        return <div className="h-full p-6 pt-10 flex flex-col animate-fade-in"><header className="flex justify-between items-center mb-8"><h2 className="text-2xl font-black text-white flex gap-2"><Icon name="Flame" className="text-orange-500"/> L'Oracle</h2><button onClick={onExit} className="p-2 bg-white/5 rounded-full text-slate-400"><Icon name="X" size={20}/></button></header>{!result ? <div className="flex-1 flex flex-col items-center justify-center text-center"><div onClick={drawOracle} className="w-48 h-48 bg-gradient-to-br from-orange-500 to-red-600 rounded-full flex items-center justify-center shadow-[0_0_60px_rgba(234,88,12,0.4)] cursor-pointer active:scale-95 transition-transform animate-pulse-slow">{loading ? <Icon name="Flame" size={64} className="text-white animate-spin"/> : <span className="text-white font-black text-xl">TOUCHER</span>}</div><p className="mt-8 text-white font-bold text-lg">D√©couvre ton message</p></div> : <div className="flex-1 flex flex-col animate-slide-up" onClick={drawOracle}><GlassPanel className="p-8 border-t-4 border-t-orange-500 flex-1 flex flex-col justify-center cursor-pointer active:scale-[0.98] transition-transform"><span className="text-xs font-bold text-orange-400 uppercase tracking-widest mb-4 block">{result.title}</span><p className="text-2xl text-white leading-relaxed font-serif italic font-medium">{result.text}</p><div className="mt-auto pt-8 text-center text-slate-500 text-xs uppercase tracking-widest flex items-center justify-center gap-2"><Icon name="Zap" size={14}/> Tap pour un autre message</div></GlassPanel></div>}</div>;
    };

    const IdentityModule = ({ onExit }) => {
        const [index, setIndex] = useState(0); const [answers, setAnswers] = useState({}); const [currentInput, setCurrentInput] = useState(""); const [analyzing, setAnalyzing] = useState(false);
        const handleNext = (val) => { const finalVal = val || currentInput || "Pass√©"; setAnswers({...answers, [IDENTITY_QS[index].id]: finalVal}); setCurrentInput(""); if (index < IDENTITY_QS.length - 1) setIndex(index + 1); else setAnalyzing(true); };
        if (analyzing) return <div className="h-full p-6 flex flex-col items-center justify-center"><Icon name="Sparkles" className="animate-spin text-fuchsia-500 mb-4" size={40}/><p>Synth√®se en cours...</p><button onClick={onExit} className="mt-8 text-slate-500">Quitter</button></div>;
        return <div className="h-full p-6 pt-10 bg-slate-900 flex flex-col relative animate-fade-in"><button onClick={onExit} className="absolute top-6 right-6 p-2 bg-white/5 rounded-full text-slate-400"><Icon name="X" size={20}/></button><div className="w-full h-1 bg-slate-800 rounded-full mb-8 mt-4"><div className="h-full bg-gradient-to-r from-violet-500 to-fuchsia-500 transition-all duration-300" style={{width: `${((index)/IDENTITY_QS.length)*100}%`}}/></div><div className="flex-1 flex flex-col justify-center"><span className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Item {index + 1}</span><h2 className="text-4xl font-black text-white mb-8 leading-tight">{IDENTITY_QS[index].label} ?</h2><input autoFocus value={currentInput} onChange={(e) => setCurrentInput(e.target.value)} className="w-full bg-transparent border-b-2 border-slate-700 text-3xl font-bold text-white pb-2 focus:outline-none focus:border-fuchsia-500 transition-colors placeholder-slate-800" placeholder="..."/><div className="mt-12 flex gap-4"><button onClick={() => handleNext("Joker")} className="p-4 rounded-xl border border-slate-700 text-slate-500 font-bold text-sm hover:text-white transition-colors"><Icon name="SkipForward"/></button><ActionButton onClick={() => handleNext()} disabled={!currentInput} className="flex-1">Valider</ActionButton></div></div></div>;
    };

    const Journal = ({ onExit }) => {
        const [entries, setEntries] = useState([]); const [isWriting, setIsWriting] = useState(false); const [newNote, setNewNote] = useState({ title: '', text: '' });
        const saveEntry = () => { if(!newNote.text) return; setEntries([{ id: Date.now(), date: new Date().toLocaleDateString(), ...newNote }, ...entries]); setNewNote({ title: '', text: '' }); setIsWriting(false); };
        return <div className="h-full bg-slate-900 flex flex-col relative">{!isWriting ? (<><header className="p-6 pt-10 flex justify-between items-center bg-slate-900/90 backdrop-blur-md z-10 sticky top-0 shrink-0"><h2 className="text-2xl font-black text-white flex items-center gap-3"><Icon name="Book" className="text-indigo-400"/> Journal</h2><button onClick={onExit} className="p-2 bg-white/5 rounded-full text-slate-400"><Icon name="X" size={20}/></button></header><div className="flex-1 overflow-y-auto p-6 space-y-4 pb-32 scrollbar-hide">{entries.length === 0 && <div className="text-slate-500 text-center mt-20">Vide.</div>}{entries.map(e => (<GlassPanel key={e.id} className="p-5 active:scale-[0.98] transition-transform"><div className="flex justify-between mb-2"><span className="text-[10px] font-bold text-indigo-300 uppercase flex items-center gap-1"><Icon name="Clock" size={10}/> {e.date}</span></div><h3 className="font-bold text-white mb-1">{e.title}</h3><p className="text-slate-400 text-sm line-clamp-2">{e.text}</p></GlassPanel>))}</div><button onClick={() => setIsWriting(true)} className="absolute bottom-24 right-6 w-14 h-14 rounded-full bg-fuchsia-600 text-white flex items-center justify-center shadow-lg hover:scale-110 transition-transform z-20"><Icon name="Plus" size={28}/></button></>) : (<div className="absolute inset-0 bg-slate-900 z-50 flex flex-col animate-slide-up h-full"><header className="p-6 pt-10 flex justify-between items-center shrink-0"><button onClick={() => setIsWriting(false)} className="text-slate-400 font-bold p-2">Annuler</button><h3 className="text-white font-bold">Nouvelle Note</h3><button onClick={saveEntry} className="text-emerald-400 font-bold p-2">Enregistrer</button></header><div className="flex-1 p-6 flex flex-col gap-4 overflow-y-auto"><input placeholder="Titre..." value={newNote.title} onChange={e => setNewNote({...newNote, title: e.target.value})} className="bg-transparent text-3xl font-black text-white placeholder-slate-700 focus:outline-none shrink-0"/><textarea placeholder="√âcris ce que tu as sur le coeur..." value={newNote.text} onChange={e => setNewNote({...newNote, text: e.target.value})} className="flex-1 bg-transparent text-lg text-slate-300 placeholder-slate-700 resize-none focus:outline-none leading-relaxed h-full"/></div></div>)}</div>;
    };

    const BreathModule = ({ onExit }) => {
        const [phase, setPhase] = useState('Inspire'); const [scale, setScale] = useState(1);
        useEffect(() => { const cycle = () => { setPhase('Inspire (4s)'); setScale(1.5); setTimeout(() => { setPhase('Bloque (2s)'); setTimeout(() => { setPhase('Expire (6s)'); setScale(1); }, 2000); }, 4000); }; cycle(); const interval = setInterval(cycle, 12000); return () => clearInterval(interval); }, []);
        return <div className="h-full flex flex-col items-center justify-center bg-slate-900 relative overflow-hidden animate-fade-in"><button onClick={onExit} className="absolute top-6 right-6 text-slate-400 z-50"><Icon name="X" size={24}/></button><div className="text-center relative z-10"><h2 className="text-3xl font-black text-white mb-2">{phase}</h2><p className="text-teal-300 text-sm font-bold uppercase tracking-widest">Coh√©rence Cardiaque</p></div><div className="relative mt-12 w-64 h-64 flex items-center justify-center"><div className="w-32 h-32 bg-gradient-to-br from-teal-400 to-emerald-500 rounded-full shadow-[0_0_50px_rgba(45,212,191,0.5)] transition-all ease-in-out" style={{ transform: `scale(${scale})`, transitionDuration: phase.includes('Inspire')?'4000ms':phase.includes('Expire')?'6000ms':'0ms' }}/><div className="absolute inset-0 border-2 border-white/10 rounded-full animate-ping opacity-20"/></div></div>;
    };

    const AIFeedback = ({ onExit }) => {
        const [loading, setLoading] = useState(true); useEffect(() => { setTimeout(() => setLoading(false), 2000); }, []);
        if (loading) return <div className="h-full flex flex-col items-center justify-center p-8 bg-slate-900"><Icon name="Sparkles" size={40} className="text-white animate-pulse mb-4"/><p>Analyse...</p></div>;
        return <div className="h-full bg-slate-900 p-6 overflow-y-auto animate-fade-in pb-20 scrollbar-hide"><GlassPanel className="p-6"><h3 className="text-lg font-bold text-white mb-2">Bilan</h3><p className="text-slate-300 leading-relaxed text-sm">Tu as bien identifi√© tes √©motions.</p></GlassPanel><ActionButton onClick={onExit} className="w-full mt-8" variant="secondary">Retour</ActionButton></div>;
    };

    // --- MAIN ---
    const TheraSpace = () => {
        const [view, setView] = useState('auth'); const [user, setUser] = useState(null);
        return (
            <div className="w-full h-screen max-w-md mx-auto bg-slate-900 shadow-2xl border-x border-white/5 relative flex flex-col">
                <div className="flex-1 overflow-hidden">
                    {view === 'auth' && <AuthScreen onLogin={u => { setUser(u); setView('dashboard'); }} />}
                    {view === 'dashboard' && <Dashboard onNavigate={setView} user={user} />}
                    {view === 'echo' && <EchoGame onExit={()=>setView('dashboard')} onFinish={()=>setView('feedback')}/>}
                    {view === 'feedback' && <AIFeedback onExit={()=>setView('dashboard')} />}
                    {view === 'hero' && <HeroModule onExit={()=>setView('dashboard')}/>}
                    {view === 'oracle' && <OracleModule onExit={()=>setView('dashboard')}/>}
                    {view === 'identity' && <IdentityModule onExit={()=>setView('dashboard')} user={user}/>}
                    {view === 'breath' && <BreathModule onExit={()=>setView('dashboard')}/>}
                    {view === 'journal' && <Journal onExit={()=>setView('dashboard')}/>}
                    {view === 'profile' && <IdentityModule onExit={()=>setView('dashboard')} user={user}/>}
                </div>
                {view === 'dashboard' && <div className="absolute bottom-8 left-1/2 -translate-x-1/2 w-[90%] h-16 bg-[#0f0b1e]/90 backdrop-blur-xl border border-white/10 rounded-full flex items-center justify-around px-4 shadow-2xl z-50">
                    <NavIcon Icon={Home} active onClick={()=>setView('dashboard')}/>
                    <NavIcon Icon={Wind} onClick={()=>setView('breath')}/>
                    <button onClick={()=>setView('oracle')} className="w-12 h-12 rounded-full bg-gradient-to-tr from-orange-500 to-red-600 text-white flex items-center justify-center shadow-lg -translate-y-4 border-4 border-[#0f0b1e]"><Icon name="Flame" size={22}/></button>
                    <NavIcon Icon={Shield} onClick={()=>setView('hero')}/>
                    <NavIcon Icon={User} onClick={()=>setView('profile')}/>
                </div>}
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TheraSpace />);
  </script>
</body>
</html>



